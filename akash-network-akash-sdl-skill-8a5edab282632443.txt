Directory structure:
└── akash-network-akash-sdl-skill/
    ├── README.md
    ├── LICENSE
    ├── SKILL.md
    └── rules/
        ├── compute-resources.md
        ├── deployment.md
        ├── endpoints.md
        ├── placement-pricing.md
        ├── schema-overview.md
        ├── services.md
        ├── validation-rules.md
        └── examples/
            ├── gpu-workload.md
            ├── ip-lease.md
            ├── web-app.md
            └── wordpress-db.md

================================================
FILE: README.md
================================================
# Akash SDL Skill for Claude Code

A Claude Code skill that generates valid Akash Network SDL (Stack Definition Language) configurations for deploying containerized applications on the decentralized cloud.

## Installation

```bash
claude skill add https://github.com/akash-network/akash-sdl-skill
```

## Usage

Once installed, Claude will automatically use this skill when you ask it to:

- "Create an Akash deployment for..."
- "Generate SDL for..."
- "Deploy to Akash..."
- "Create Akash config for..."

### Examples

```
> Generate an SDL for a simple nginx web server

> Create an Akash deployment for WordPress with a MySQL database

> Deploy a GPU workload with an NVIDIA A100 on Akash

> Generate SDL for a game server with a dedicated IP
```

## Usage by Agent

This skill can be used with various AI coding assistants:

### Claude Code
```bash
claude skill add https://github.com/akash-network/akash-sdl-skill
```

### Cursor
Copy the contents of the `rules/` directory to your project's `.cursorrules` file or add as project rules in Cursor settings.

### Windsurf
Add the rules content to Cascade rules or memory for persistent context.

### Cline
Add as custom instructions in Cline extension settings.

### Codex / OpenCode
Include the rules as system prompt context when initializing your session.

### Generic Integration
For other AI assistants or custom setups, reference the [`rules/`](./rules/) directory directly. Each markdown file contains structured guidelines that can be adapted to any LLM's instruction format.

## What's Included

### Rules
- **schema-overview.md** - SDL structure and version requirements
- **services.md** - Service configuration (image, expose, env, credentials)
- **compute-resources.md** - CPU, memory, storage, and GPU specifications
- **placement-pricing.md** - Provider selection and pricing (uakt/USDC)
- **deployment.md** - Service-to-profile mapping
- **endpoints.md** - IP endpoint configuration (v2.1)
- **validation-rules.md** - All constraints and validation rules

### Examples
- **web-app.md** - Simple web deployment
- **wordpress-db.md** - Multi-service with persistent storage
- **gpu-workload.md** - GPU deployment with NVIDIA
- **ip-lease.md** - IP endpoint configuration

## Features

- **SDL v2.0 and v2.1** support (IP endpoints)
- **All resource types**: CPU, memory, storage classes, GPUs
- **Payment options**: uakt (native AKT) and USDC via IBC
- **Persistent storage** with beta2/beta3/ram classes
- **GPU models**: A100, T4, RTX 3090, and more
- **IP lease endpoints** for custom domains
- **Comprehensive validation** rules

## Resources

- [awesome-akash](https://github.com/akash-network/awesome-akash) - 100+ production-ready SDL templates
- [Akash Network Docs](https://akash.network/docs/)
- [chain-sdk](https://github.com/akash-network/chain-sdk) - Official SDL schema reference

## License

MIT



================================================
FILE: LICENSE
================================================
MIT License

Copyright (c) 2025 baktun14

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.



================================================
FILE: SKILL.md
================================================
---
name: akash-sdl
description: Generate valid Akash Network SDL configurations for deploying containers on the decentralized cloud. Use when asked to "create Akash deployment", "generate SDL", "deploy to Akash", or "Akash config".
license: MIT
metadata:
  author: baktun14
  version: "1.0.0"
  argument-hint: <deployment-description>
---

# Akash SDL Generator

Generate valid Akash Network Stack Definition Language (SDL) configurations for deploying containerized applications on the decentralized cloud.

## SDL Structure Overview

Every SDL file has four required sections:

```yaml
version: "2.0"  # or "2.1" for IP endpoints

services:       # Container definitions
profiles:       # Compute resources & placement
deployment:     # Service-to-profile mapping
```

Optional section for IP endpoints:
```yaml
endpoints:      # IP lease endpoints (requires version 2.1)
```

## Quick Reference

### Minimal SDL Template

```yaml
version: "2.0"

services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80
        as: 80
        to:
          - global: true

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi
  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000

deployment:
  web:
    dcloud:
      profile: web
      count: 1
```

## Detailed Rules

For complete configuration options, see the rules directory:

- **@schema-overview.md** - Version requirements and SDL structure
- **@services.md** - Service configuration (image, expose, env, credentials)
- **@compute-resources.md** - CPU, memory, storage, and GPU specifications
- **@placement-pricing.md** - Provider selection and pricing configuration
- **@deployment.md** - Service-to-profile deployment mapping
- **@endpoints.md** - IP endpoint configuration (v2.1)
- **@validation-rules.md** - All constraints and validation rules

## Examples

See the examples directory for complete working configurations:

- **@examples/web-app.md** - Simple web deployment
- **@examples/wordpress-db.md** - Multi-service with persistent storage
- **@examples/gpu-workload.md** - GPU deployment with NVIDIA
- **@examples/ip-lease.md** - IP endpoint configuration

For 100+ production-ready templates, see [awesome-akash](https://github.com/akash-network/awesome-akash).

## Common Patterns

### Environment Variables
```yaml
services:
  app:
    env:
      - "DATABASE_URL=postgres://..."
      - "NODE_ENV=production"
```

### Persistent Storage
```yaml
profiles:
  compute:
    app:
      resources:
        storage:
          - size: 10Gi
            attributes:
              persistent: true
              class: beta2
```

### GPU Workloads
```yaml
profiles:
  compute:
    ml:
      resources:
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
                - model: a100
```

### Payment Options
- **uakt**: Native Akash Token (e.g., `amount: 1000`)
- **USDC**: Via IBC denom (e.g., `denom: ibc/170C677610AC31DF0904FFE09CD3B5C657492170E7E52372E48756B71E56F2F1`)

## Additional Resources

- **[awesome-akash](https://github.com/akash-network/awesome-akash)** - Community-curated library of production-ready SDL templates for databases, AI/ML, gaming, web apps, and more
- **[chain-sdk](https://github.com/akash-network/chain-sdk/tree/main/ts/src/sdl)** - Official SDL schema and validation reference



================================================
FILE: rules/compute-resources.md
================================================
# Compute Resources Configuration

The `profiles.compute` section defines resource requirements for each service profile.

## Basic Structure

```yaml
profiles:
  compute:
    <profile-name>:
      resources:
        cpu:
          units: <cpu-units>
        memory:
          size: <memory-size>
        storage:
          size: <storage-size>
```

## CPU Configuration

CPU units can be specified in three formats:

| Format | Example | Description |
|--------|---------|-------------|
| Decimal | `0.5` | Half a CPU core |
| Integer | `2` | Two CPU cores |
| Millicores | `500m` | 500 millicores (= 0.5 cores) |

```yaml
profiles:
  compute:
    web:
      resources:
        cpu:
          units: 0.5      # Half a core

    api:
      resources:
        cpu:
          units: 2        # Two cores

    worker:
      resources:
        cpu:
          units: 1500m    # 1.5 cores
```

## Memory Configuration

Memory size with standard suffixes:

| Suffix | Meaning | Example |
|--------|---------|---------|
| `Ki` | Kibibytes (1024) | `512Ki` |
| `Mi` | Mebibytes (1024²) | `512Mi` |
| `Gi` | Gibibytes (1024³) | `2Gi` |
| `Ti` | Tebibytes (1024⁴) | `1Ti` |
| `k` | Kilobytes (1000) | `512k` |
| `M` | Megabytes (1000²) | `512M` |
| `G` | Gigabytes (1000³) | `2G` |
| `T` | Terabytes (1000⁴) | `1T` |

```yaml
profiles:
  compute:
    web:
      resources:
        memory:
          size: 512Mi     # 512 mebibytes

    ml:
      resources:
        memory:
          size: 16Gi      # 16 gibibytes
```

## Storage Configuration

### Simple Storage

Single ephemeral storage volume:

```yaml
profiles:
  compute:
    web:
      resources:
        storage:
          size: 1Gi
```

### Named Storage Volumes

Array of named volumes for more control:

```yaml
profiles:
  compute:
    db:
      resources:
        storage:
          - name: default
            size: 1Gi
          - name: data
            size: 10Gi
            attributes:
              persistent: true
              class: beta2
```

### Storage Attributes

| Attribute | Values | Description |
|-----------|--------|-------------|
| `persistent` | `true`/`false` | Data survives restarts |
| `class` | `beta2`, `beta3`, `ram` | Storage class type |

```yaml
storage:
  - name: data
    size: 10Gi
    attributes:
      persistent: true
      class: beta2          # SSD storage

  - name: cache
    size: 1Gi
    attributes:
      persistent: false
      class: ram            # RAM-based (fast, volatile)
```

### Storage Constraints

1. **RAM class cannot be persistent**: `class: ram` with `persistent: true` is invalid
2. **Non-RAM with attributes requires persistent**: If using `class: beta2` or `beta3`, must set `persistent: true`

## GPU Configuration

For GPU workloads:

```yaml
profiles:
  compute:
    ml:
      resources:
        cpu:
          units: 4
        memory:
          size: 16Gi
        storage:
          size: 50Gi
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
```

### GPU Attributes

```yaml
gpu:
  units: 1
  attributes:
    vendor:
      nvidia:
        - model: a100       # Specific model
          ram: 80Gi         # GPU memory
          interface: sxm    # Interface type: pcie or sxm
```

### Available GPU Models

Common NVIDIA models:
- `a100` - NVIDIA A100
- `a10` - NVIDIA A10
- `a6000` - NVIDIA RTX A6000
- `rtx3080` - NVIDIA RTX 3080
- `rtx3090` - NVIDIA RTX 3090
- `t4` - NVIDIA T4
- `v100` - NVIDIA V100

### GPU Constraints

1. **GPU with units > 0 must have attributes with vendor**
2. **GPU with units = 0 cannot have attributes**

```yaml
# Valid: GPU with vendor
gpu:
  units: 1
  attributes:
    vendor:
      nvidia:

# Valid: No GPU
gpu:
  units: 0

# Invalid: GPU without vendor
gpu:
  units: 1          # Error: must have vendor attribute
```

## Complete Example

```yaml
profiles:
  compute:
    frontend:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi

    backend:
      resources:
        cpu:
          units: 2
        memory:
          size: 2Gi
        storage:
          - name: default
            size: 2Gi
          - name: uploads
            size: 10Gi
            attributes:
              persistent: true
              class: beta2

    ml-worker:
      resources:
        cpu:
          units: 8
        memory:
          size: 32Gi
        storage:
          size: 100Gi
        gpu:
          units: 2
          attributes:
            vendor:
              nvidia:
                - model: a100
                  ram: 80Gi
```



================================================
FILE: rules/deployment.md
================================================
# Deployment Configuration

The `deployment` section maps services to placement profiles, specifying where and how many instances to run.

## Basic Structure

```yaml
deployment:
  <service-name>:
    <placement-name>:
      profile: <compute-profile-name>
      count: <instance-count>
```

## Deployment Properties

### profile (required)

References a compute profile defined in `profiles.compute`:

```yaml
profiles:
  compute:
    web-profile:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi

deployment:
  web:
    dcloud:
      profile: web-profile    # References 'web-profile' from profiles.compute
      count: 1
```

### count (required)

Number of instances to deploy (minimum 1):

```yaml
deployment:
  web:
    dcloud:
      profile: web
      count: 3    # Deploy 3 instances
```

## Matching Rules

1. **Service name** must exist in `services` section
2. **Placement name** must exist in `profiles.placement` section
3. **Profile name** must exist in `profiles.compute` section
4. **Pricing** must be defined in the placement for the referenced profile

## Single Service Example

```yaml
version: "2.0"

services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80
        to:
          - global: true

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi
  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000

deployment:
  web:                    # Matches 'web' in services
    dcloud:               # Matches 'dcloud' in profiles.placement
      profile: web        # Matches 'web' in profiles.compute
      count: 1
```

## Multi-Service Example

```yaml
version: "2.0"

services:
  frontend:
    image: myapp/frontend:v1.0.0
    expose:
      - port: 80
        to:
          - global: true

  backend:
    image: myapp/backend:v1.0.0
    expose:
      - port: 8080
        to:
          - service: frontend

  database:
    image: postgres:15
    expose:
      - port: 5432
        to:
          - service: backend

profiles:
  compute:
    frontend-profile:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi

    backend-profile:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi

    db-profile:
      resources:
        cpu:
          units: 2
        memory:
          size: 2Gi
        storage:
          - name: default
            size: 1Gi
          - name: data
            size: 20Gi
            attributes:
              persistent: true
              class: beta2

  placement:
    dcloud:
      pricing:
        frontend-profile:
          denom: uakt
          amount: 500
        backend-profile:
          denom: uakt
          amount: 1000
        db-profile:
          denom: uakt
          amount: 2000

deployment:
  frontend:
    dcloud:
      profile: frontend-profile
      count: 2              # 2 frontend instances

  backend:
    dcloud:
      profile: backend-profile
      count: 3              # 3 backend instances

  database:
    dcloud:
      profile: db-profile
      count: 1              # 1 database instance
```

## Multiple Placements

Deploy to different placements:

```yaml
profiles:
  placement:
    us-region:
      attributes:
        region: us-west
      pricing:
        web:
          denom: uakt
          amount: 1000

    eu-region:
      attributes:
        region: eu-central
      pricing:
        web:
          denom: uakt
          amount: 1200

deployment:
  web:
    us-region:
      profile: web
      count: 2

    eu-region:
      profile: web
      count: 1
```

## Scaling Considerations

- Each placement can have different instance counts
- Higher counts require more resources and higher pricing budget
- Database services typically use `count: 1` unless using replication
- Stateless services (web, API) can scale horizontally with higher counts



================================================
FILE: rules/endpoints.md
================================================
# IP Endpoints Configuration

IP endpoints allow you to lease dedicated IP addresses for your deployments. This feature requires SDL version 2.1.

## Version Requirement

```yaml
version: "2.1"    # Required for IP endpoints
```

## Basic Structure

### 1. Declare the endpoint

```yaml
endpoints:
  <endpoint-name>:
    kind: ip
```

### 2. Reference in service expose

```yaml
services:
  web:
    expose:
      - port: 80
        to:
          - ip: <endpoint-name>
```

## Complete Example

```yaml
version: "2.1"

services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80
        as: 80
        to:
          - ip: myip
      - port: 443
        as: 443
        to:
          - ip: myip

endpoints:
  myip:
    kind: ip

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi
  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000

deployment:
  web:
    dcloud:
      profile: web
      count: 1
```

## Endpoint Rules

| Rule | Description |
|------|-------------|
| Must be global scope | IP endpoints expose services to the internet |
| Must be used | Declared endpoints must be referenced by at least one service |
| Single kind | Currently only `kind: ip` is supported |
| Version 2.1 | IP endpoints require SDL version "2.1" |

## Multiple Ports on Same IP

You can expose multiple ports through the same IP endpoint:

```yaml
services:
  app:
    image: myapp:v1.0.0
    expose:
      - port: 80
        as: 80
        to:
          - ip: public-ip
      - port: 443
        as: 443
        to:
          - ip: public-ip
      - port: 22
        as: 22
        proto: tcp
        to:
          - ip: public-ip

endpoints:
  public-ip:
    kind: ip
```

## Multiple IP Endpoints

You can declare multiple IP endpoints for different services:

```yaml
version: "2.1"

services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80
        to:
          - ip: web-ip

  api:
    image: myapi:v1.0.0
    expose:
      - port: 8080
        as: 80
        to:
          - ip: api-ip

endpoints:
  web-ip:
    kind: ip
  api-ip:
    kind: ip

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi
    api:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi

  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 500
        api:
          denom: uakt
          amount: 1000

deployment:
  web:
    dcloud:
      profile: web
      count: 1
  api:
    dcloud:
      profile: api
      count: 1
```

## Combining Global and IP Exposure

You can expose a service both via the default Akash hostname and a dedicated IP:

```yaml
services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80
        as: 80
        to:
          - global: true    # Akash-provided hostname
      - port: 80
        as: 8080
        to:
          - ip: dedicated   # Dedicated IP on port 8080

endpoints:
  dedicated:
    kind: ip
```

## When to Use IP Endpoints

| Use Case | Recommendation |
|----------|----------------|
| Standard web apps | Use `global: true` (default hostnames) |
| Custom domains | Use IP endpoint with DNS A record |
| Non-HTTP protocols | Use IP endpoint |
| Multiple ports | Use IP endpoint |
| Gaming servers | Use IP endpoint (UDP support) |
| Email servers | Use IP endpoint |

## Cost Considerations

IP endpoints have additional costs on top of compute resources. The IP lease is billed separately from the deployment pricing. Factor this into your budget when designing deployments.



================================================
FILE: rules/placement-pricing.md
================================================
# Placement and Pricing Configuration

The `profiles.placement` section defines where deployments run and their pricing.

## Basic Structure

```yaml
profiles:
  placement:
    <placement-name>:
      pricing:
        <profile-name>:
          denom: uakt
          amount: 1000
```

## Placement Properties

### pricing (required)

Defines the maximum price you're willing to pay per block for each compute profile:

```yaml
profiles:
  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000
        api:
          denom: uakt
          amount: 2000
```

### attributes (optional)

Filter providers by attributes:

```yaml
profiles:
  placement:
    dcloud:
      attributes:
        region: us-west
        host: akash
      pricing:
        web:
          denom: uakt
          amount: 1000
```

Common attributes:
- `region` - Geographic region
- `host` - Hosting provider name
- `tier` - Service tier level

### signedBy (optional)

Require providers to be audited:

```yaml
profiles:
  placement:
    dcloud:
      signedBy:
        anyOf:
          - akash1365yvmc4s7awdyj3n2sav7xfx76adc6dnmlx63
          - akash18qa2a2ltfyvkyj0ggj3hkvuj6twzyumuaru9s4
      pricing:
        web:
          denom: uakt
          amount: 1000
```

#### signedBy Options

| Field | Description |
|-------|-------------|
| `anyOf` | Provider signed by at least one of these auditors |
| `allOf` | Provider must be signed by all of these auditors |

```yaml
signedBy:
  allOf:
    - akash1auditor1...
    - akash1auditor2...
  anyOf:
    - akash1auditor3...
```

## Payment Denominations

### uakt (Native AKT)

The native Akash token in micro-denomination:

```yaml
pricing:
  web:
    denom: uakt
    amount: 1000      # 0.001 AKT per block
```

### USDC via IBC

Stable coin payment using IBC denomination:

```yaml
pricing:
  web:
    denom: ibc/170C677610AC31DF0904FFE09CD3B5C657492170E7E52372E48756B71E56F2F1
    amount: 100       # USDC amount per block
```

### Price Calculation

- Prices are per block (approximately every 6 seconds)
- Monthly cost ≈ amount × 438,000 blocks/month
- Example: `amount: 1000` uakt ≈ 438,000,000 uakt/month ≈ 438 AKT/month

## Multiple Placements

You can define multiple placement options:

```yaml
profiles:
  placement:
    us-east:
      attributes:
        region: us-east
      signedBy:
        anyOf:
          - akash1auditor...
      pricing:
        web:
          denom: uakt
          amount: 1000

    eu-west:
      attributes:
        region: eu-west
      pricing:
        web:
          denom: uakt
          amount: 1200
```

## Complete Example

```yaml
profiles:
  compute:
    web:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi

    api:
      resources:
        cpu:
          units: 2
        memory:
          size: 2Gi
        storage:
          size: 10Gi

  placement:
    primary:
      attributes:
        region: us-west
      signedBy:
        anyOf:
          - akash1365yvmc4s7awdyj3n2sav7xfx76adc6dnmlx63
      pricing:
        web:
          denom: uakt
          amount: 1000
        api:
          denom: uakt
          amount: 2000

    backup:
      attributes:
        region: eu-central
      pricing:
        web:
          denom: ibc/170C677610AC31DF0904FFE09CD3B5C657492170E7E52372E48756B71E56F2F1
          amount: 50
        api:
          denom: ibc/170C677610AC31DF0904FFE09CD3B5C657492170E7E52372E48756B71E56F2F1
          amount: 100
```

## Pricing Guidelines

| Workload Type | Suggested uakt/block | Notes |
|---------------|---------------------|-------|
| Small web app | 500-1000 | 0.5 CPU, 512Mi RAM |
| API server | 1000-2000 | 1-2 CPU, 1-2Gi RAM |
| Database | 2000-5000 | Depends on storage |
| GPU workload | 10000-50000+ | Varies by GPU model |

Higher pricing increases likelihood of provider acceptance. Start with recommended ranges and adjust based on market conditions.



================================================
FILE: rules/schema-overview.md
================================================
# SDL Schema Overview

## Version Requirement

The SDL version must be specified as the first field:

```yaml
version: "2.0"
```

Use version `"2.1"` when you need IP endpoints:

```yaml
version: "2.1"
```

## Required Sections

Every valid SDL must contain these four sections:

| Section | Purpose |
|---------|---------|
| `version` | SDL version string |
| `services` | Container and workload definitions |
| `profiles` | Compute resources and placement configuration |
| `deployment` | Maps services to placement profiles |

## Optional Sections

| Section | Purpose | Requires Version |
|---------|---------|------------------|
| `endpoints` | IP lease endpoint declarations | 2.1 |

## Basic Structure

```yaml
version: "2.0"

services:
  <service-name>:
    image: <container-image>
    expose:
      - port: <port>
        to:
          - global: true

profiles:
  compute:
    <profile-name>:
      resources:
        cpu:
          units: <cpu-units>
        memory:
          size: <memory-size>
        storage:
          size: <storage-size>
  placement:
    <placement-name>:
      pricing:
        <profile-name>:
          denom: uakt
          amount: <price>

deployment:
  <service-name>:
    <placement-name>:
      profile: <profile-name>
      count: <instance-count>
```

## Naming Rules

- Service names, profile names, and placement names must be valid identifiers
- Use lowercase letters, numbers, and hyphens
- Names must start with a letter
- Names are case-sensitive

## Section Dependencies

1. **services** - Defines what containers to run
2. **profiles.compute** - Defines resource requirements for each service
3. **profiles.placement** - Defines where to deploy and pricing per compute profile
4. **deployment** - Links services to placements using compute profiles

All service names referenced in `deployment` must exist in `services`.
All profile names referenced in `deployment` must exist in `profiles.compute`.
All placement names used in `deployment` must exist in `profiles.placement`.



================================================
FILE: rules/services.md
================================================
# Services Configuration

The `services` section defines the containers and workloads to deploy.

## Basic Service Definition

```yaml
services:
  <service-name>:
    image: <container-image>
    expose:
      - port: <port>
        to:
          - global: true
```

## Service Properties

### image (required)

The container image to deploy. **Must include an explicit tag** - the `latest` tag is not allowed.

```yaml
services:
  web:
    image: nginx:1.25.3       # Explicit version tag

  app:
    image: node:18-alpine     # Version with variant

  api:
    image: myapp:v1.2.0       # Semantic version
```

**Important:** Do not use `:latest` or omit the tag. Akash requires explicit tags for reproducible deployments.

### command (optional)

Override the container's default command:

```yaml
services:
  app:
    image: node:18
    command:
      - "node"
      - "server.js"
```

### args (optional)

Arguments passed to the command:

```yaml
services:
  app:
    image: myapp:v1.0.0
    args:
      - "--config"
      - "/etc/config.yaml"
```

### env (optional)

Environment variables as an array of strings:

```yaml
services:
  app:
    image: myapp:v1.0.0
    env:
      - "NODE_ENV=production"
      - "DATABASE_URL=postgres://user:pass@db:5432/mydb"
      - "SECRET_KEY=mysecretkey"
```

### expose (required for accessible services)

Port exposure configuration:

```yaml
services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80        # Container port (1-65535)
        as: 80          # External port (optional, defaults to port)
        proto: tcp      # Protocol: tcp (default) or udp
        to:
          - global: true    # Expose to internet
```

#### Expose Options

| Field | Type | Description |
|-------|------|-------------|
| `port` | integer | Container port (1-65535, required) |
| `as` | integer | External port (1-65535, optional) |
| `proto` | string | Protocol: `tcp` (default) or `udp` |
| `to` | array | Exposure targets |

#### Exposure Targets

```yaml
expose:
  - port: 80
    to:
      - global: true          # Internet accessible

  - port: 5432
    to:
      - service: web          # Only accessible by 'web' service

  - port: 8080
    to:
      - ip: myendpoint        # Expose via IP endpoint (requires v2.1)
```

#### HTTP Options

For HTTP services, additional options are available:

```yaml
expose:
  - port: 80
    as: 80
    to:
      - global: true
    http_options:
      max_body_size: 1048576      # Max request body (bytes, 0-104857600)
      read_timeout: 60000         # Read timeout (ms, 0-60000)
      send_timeout: 60000         # Send timeout (ms, 0-60000)
      next_tries: 3               # Retry attempts
      next_timeout: 0             # Retry timeout (ms)
      next_cases:                 # Retry conditions (all values must be strings)
        - error
        - timeout
        - "500"                   # HTTP status codes must be quoted
        - "502"
        - "503"
```

### credentials (optional)

For private container registries:

```yaml
services:
  app:
    image: registry.example.com/myapp:v1.0.0
    credentials:
      host: registry.example.com
      username: myuser
      password: mypassword
```

### params (optional)

Storage mount configuration:

```yaml
services:
  db:
    image: postgres:15
    params:
      storage:
        data:
          mount: /var/lib/postgresql/data
          readOnly: false
```

The storage name (`data` in the example) must match a named storage volume in the compute profile.

### dependencies (optional)

Declare service startup dependencies. The service will wait for dependent services to be ready before starting:

```yaml
services:
  api:
    image: myapp:v1.0.0
    dependencies:
      - service: database
      - service: cache
    expose:
      - port: 3000
        to:
          - global: true

  database:
    image: postgres:15
    expose:
      - port: 5432
        to:
          - service: api

  cache:
    image: redis:7
    expose:
      - port: 6379
        to:
          - service: api
```

**Note:** Dependencies control startup order. For network access, you must also expose ports using the `to: - service: <name>` directive.

## Service-to-Service Communication

Services can communicate using their service names as hostnames:

```yaml
services:
  web:
    image: nginx:1.25.3
    env:
      - "API_URL=http://api:3000"
    expose:
      - port: 80
        to:
          - global: true

  api:
    image: myapi:v1.0.0
    expose:
      - port: 3000
        to:
          - service: web    # Only web can access
```

## Complete Example

```yaml
services:
  frontend:
    image: myapp/frontend:v1.0
    env:
      - "API_URL=http://backend:8080"
    expose:
      - port: 3000
        as: 80
        to:
          - global: true
        http_options:
          max_body_size: 5242880

  backend:
    image: myapp/backend:v1.0
    command:
      - "node"
      - "server.js"
    env:
      - "DATABASE_URL=postgres://postgres:password@db:5432/myapp"
      - "NODE_ENV=production"
    expose:
      - port: 8080
        to:
          - service: frontend

  db:
    image: postgres:15
    env:
      - "POSTGRES_PASSWORD=password"
      - "POSTGRES_DB=myapp"
    expose:
      - port: 5432
        to:
          - service: backend
    params:
      storage:
        pgdata:
          mount: /var/lib/postgresql/data
```



================================================
FILE: rules/validation-rules.md
================================================
# SDL Validation Rules

This document lists all constraints and validation rules for Akash SDL configurations.

## Image Tag Constraints

**Docker images must specify an explicit tag.** The `latest` tag is not allowed.

```yaml
# Valid - explicit version tag
services:
  web:
    image: nginx:1.25.3

# Valid - semantic version
services:
  app:
    image: node:18-alpine

# Valid - SHA digest
services:
  api:
    image: myapp@sha256:abc123...

# Invalid - latest tag
services:
  web:
    image: nginx:latest    # Error: 'latest' tag not allowed

# Invalid - no tag (implies latest)
services:
  web:
    image: nginx           # Error: must specify explicit tag
```

**Why?** The `latest` tag is mutable and can change unexpectedly, causing deployment inconsistencies. Explicit tags ensure reproducible deployments.

## Port Constraints

| Field | Valid Range | Notes |
|-------|-------------|-------|
| `port` | 1-65535 | Container port |
| `as` | 1-65535 | External port (optional) |

```yaml
# Valid
expose:
  - port: 80
    as: 8080

# Invalid - port out of range
expose:
  - port: 0       # Error: must be >= 1
  - port: 70000   # Error: must be <= 65535
```

## HTTP Options Constraints

| Field | Valid Range | Default |
|-------|-------------|---------|
| `max_body_size` | 0-104857600 (100MB) | 1048576 (1MB) |
| `read_timeout` | 0-60000 ms | 60000 |
| `send_timeout` | 0-60000 ms | 60000 |
| `next_tries` | 0-10 | 3 |
| `next_timeout` | 0-60000 ms | 0 |
| `next_cases` | Array of strings | `["error", "timeout"]` |

```yaml
# Valid
http_options:
  max_body_size: 52428800     # 50MB
  read_timeout: 30000         # 30 seconds
  next_cases:
    - error
    - timeout
    - "502"                   # HTTP status codes must be quoted strings
    - "503"
    - "504"

# Invalid
http_options:
  max_body_size: 200000000    # Error: exceeds 100MB limit
  read_timeout: 120000        # Error: exceeds 60000ms limit
  next_cases:
    - 502                     # Error: numbers must be quoted as strings
    - 503
```

## Pricing Constraints

| Field | Valid Values |
|-------|--------------|
| `denom` | `uakt` or `ibc/...` pattern |
| `amount` | Positive integer |

```yaml
# Valid - Native AKT
pricing:
  web:
    denom: uakt
    amount: 1000

# Valid - USDC via IBC
pricing:
  web:
    denom: ibc/170C677610AC31DF0904FFE09CD3B5C657492170E7E52372E48756B71E56F2F1
    amount: 100

# Invalid
pricing:
  web:
    denom: usdc       # Error: must be 'uakt' or 'ibc/...'
    amount: -100      # Error: must be positive
```

## Storage Constraints

### RAM Storage

RAM-based storage cannot be persistent:

```yaml
# Valid
storage:
  - name: cache
    size: 1Gi
    attributes:
      class: ram
      persistent: false

# Invalid
storage:
  - name: cache
    size: 1Gi
    attributes:
      class: ram
      persistent: true    # Error: RAM cannot be persistent
```

### Non-RAM Storage with Attributes

Non-RAM storage classes with attributes must be persistent:

```yaml
# Valid
storage:
  - name: data
    size: 10Gi
    attributes:
      class: beta2
      persistent: true

# Invalid
storage:
  - name: data
    size: 10Gi
    attributes:
      class: beta2
      persistent: false   # Error: non-RAM with class must be persistent
```

### Simple Storage (No Constraints)

Storage without attributes has no special constraints:

```yaml
# Valid - ephemeral storage
storage:
  size: 5Gi

# Valid - named ephemeral
storage:
  - name: default
    size: 5Gi
```

## GPU Constraints

### GPU with units > 0

Must have attributes with vendor specified:

```yaml
# Valid
gpu:
  units: 1
  attributes:
    vendor:
      nvidia:

# Valid - with model
gpu:
  units: 2
  attributes:
    vendor:
      nvidia:
        - model: a100

# Invalid - missing attributes
gpu:
  units: 1              # Error: must have attributes with vendor

# Invalid - missing vendor
gpu:
  units: 1
  attributes: {}        # Error: must specify vendor
```

### GPU with units = 0

Cannot have attributes:

```yaml
# Valid
gpu:
  units: 0

# Invalid
gpu:
  units: 0
  attributes:           # Error: cannot have attributes when units=0
    vendor:
      nvidia:
```

## Endpoint Constraints

### Must Be Global

IP endpoints implicitly expose services globally:

```yaml
# Valid
expose:
  - port: 80
    to:
      - ip: myendpoint

# The endpoint exposure is global by nature
```

### Must Be Used

Declared endpoints must be referenced:

```yaml
# Invalid - unused endpoint
endpoints:
  myip:
    kind: ip            # Error: endpoint declared but not used

services:
  web:
    expose:
      - port: 80
        to:
          - global: true    # Does not reference 'myip'
```

### Version Requirement

IP endpoints require version 2.1:

```yaml
# Valid
version: "2.1"
endpoints:
  myip:
    kind: ip

# Invalid
version: "2.0"          # Error: endpoints require version 2.1
endpoints:
  myip:
    kind: ip
```

## Reference Constraints

### Service Names

Services in `deployment` must exist in `services`:

```yaml
services:
  web:
    image: nginx:1.25.3

deployment:
  web:                  # Valid: matches 'web' in services
    dcloud:
      profile: web
      count: 1
  api:                  # Error: 'api' not defined in services
    dcloud:
      profile: api
      count: 1
```

### Dependencies

Service dependencies must reference existing services:

```yaml
services:
  api:
    image: myapp:v1.0.0
    dependencies:
      - service: database    # Valid: 'database' exists
      - service: cache       # Error if 'cache' not defined

  database:
    image: postgres:15
```

Circular dependencies should be avoided to prevent startup deadlocks.

### Profile Names

Profiles in `deployment` must exist in `profiles.compute`:

```yaml
profiles:
  compute:
    web:
      resources:
        cpu:
          units: 1

deployment:
  web:
    dcloud:
      profile: web      # Valid: matches 'web' in profiles.compute
      count: 1
  api:
    dcloud:
      profile: api      # Error: 'api' not in profiles.compute
      count: 1
```

### Placement Names

Placements in `deployment` must exist in `profiles.placement`:

```yaml
profiles:
  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000

deployment:
  web:
    dcloud:             # Valid: matches 'dcloud' in profiles.placement
      profile: web
      count: 1
    other:              # Error: 'other' not in profiles.placement
      profile: web
      count: 1
```

### Pricing Coverage

Placements must have pricing for all profiles used:

```yaml
profiles:
  compute:
    web:
      resources: ...
    api:
      resources: ...
  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000
        # Missing: api pricing

deployment:
  web:
    dcloud:
      profile: web
      count: 1
  api:
    dcloud:
      profile: api      # Error: no pricing for 'api' in 'dcloud'
      count: 1
```

## Deployment Constraints

| Field | Constraint |
|-------|------------|
| `count` | Must be >= 1 |

```yaml
# Valid
deployment:
  web:
    dcloud:
      profile: web
      count: 1

# Invalid
deployment:
  web:
    dcloud:
      profile: web
      count: 0          # Error: count must be at least 1
```

## Summary Table

| Constraint | Rule |
|------------|------|
| Image tag | Must be explicit, `latest` not allowed |
| Port range | 1-65535 |
| Timeout range | 0-60000ms |
| Body size | 0-104857600 bytes (100MB) |
| next_cases | All values must be strings (quote HTTP status codes) |
| Price denom | `uakt` or `ibc/...` pattern |
| Price amount | Positive integer |
| RAM storage | Cannot be persistent |
| Non-RAM + attributes | Requires persistent=true |
| GPU with units > 0 | Must have attributes with vendor |
| GPU with units = 0 | Cannot have attributes |
| Endpoints | Must be global, must be used, requires v2.1 |
| Deployment count | Minimum 1 |
| Dependencies | Must reference existing services |
| References | All names must match across sections |



================================================
FILE: rules/examples/gpu-workload.md
================================================
# Example: GPU Workload

SDL configurations for GPU-accelerated workloads including machine learning, AI inference, and rendering.

## Use Case

- Machine learning training
- AI inference
- Video encoding/transcoding
- 3D rendering
- Scientific computing

## Basic GPU SDL

```yaml
version: "2.0"

services:
  ml:
    image: nvidia/cuda:12.0-runtime-ubuntu22.04
    command:
      - "nvidia-smi"
      - "-l"
      - "60"
    expose:
      - port: 8080
        as: 80
        to:
          - global: true

profiles:
  compute:
    ml:
      resources:
        cpu:
          units: 4
        memory:
          size: 16Gi
        storage:
          size: 50Gi
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:

  placement:
    dcloud:
      pricing:
        ml:
          denom: uakt
          amount: 10000

deployment:
  ml:
    dcloud:
      profile: ml
      count: 1
```

## GPU Model Selection

### NVIDIA A100 (High-end Training)

```yaml
version: "2.0"

services:
  training:
    image: pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime
    command:
      - "python"
      - "train.py"
    env:
      - "CUDA_VISIBLE_DEVICES=0"
    expose:
      - port: 6006
        as: 6006
        to:
          - global: true

profiles:
  compute:
    training:
      resources:
        cpu:
          units: 8
        memory:
          size: 64Gi
        storage:
          - name: default
            size: 10Gi
          - name: models
            size: 200Gi
            attributes:
              persistent: true
              class: beta2
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
                - model: a100
                  ram: 80Gi

  placement:
    dcloud:
      pricing:
        training:
          denom: uakt
          amount: 50000

deployment:
  training:
    dcloud:
      profile: training
      count: 1
```

### NVIDIA RTX 3090 (Cost-effective Training)

```yaml
version: "2.0"

services:
  training:
    image: tensorflow/tensorflow:2.13.0-gpu
    expose:
      - port: 8888
        as: 8888
        to:
          - global: true

profiles:
  compute:
    training:
      resources:
        cpu:
          units: 8
        memory:
          size: 32Gi
        storage:
          size: 100Gi
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
                - model: rtx3090

  placement:
    dcloud:
      pricing:
        training:
          denom: uakt
          amount: 20000

deployment:
  training:
    dcloud:
      profile: training
      count: 1
```

### NVIDIA T4 (Inference)

```yaml
version: "2.0"

services:
  inference:
    image: nvcr.io/nvidia/tritonserver:23.08-py3
    command:
      - "tritonserver"
      - "--model-repository=/models"
    expose:
      - port: 8000
        as: 8000
        to:
          - global: true
      - port: 8001
        as: 8001
        to:
          - global: true

profiles:
  compute:
    inference:
      resources:
        cpu:
          units: 4
        memory:
          size: 16Gi
        storage:
          size: 50Gi
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
                - model: t4

  placement:
    dcloud:
      pricing:
        inference:
          denom: uakt
          amount: 15000

deployment:
  inference:
    dcloud:
      profile: inference
      count: 1
```

## Multi-GPU Configuration

```yaml
version: "2.0"

services:
  distributed-training:
    image: pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime
    env:
      - "WORLD_SIZE=4"
      - "MASTER_ADDR=localhost"
      - "MASTER_PORT=29500"
    expose:
      - port: 29500
        to:
          - global: true

profiles:
  compute:
    distributed-training:
      resources:
        cpu:
          units: 32
        memory:
          size: 128Gi
        storage:
          size: 500Gi
        gpu:
          units: 4
          attributes:
            vendor:
              nvidia:
                - model: a100
                  interface: sxm

  placement:
    dcloud:
      pricing:
        distributed-training:
          denom: uakt
          amount: 200000

deployment:
  distributed-training:
    dcloud:
      profile: distributed-training
      count: 1
```

## LLM Inference Example

```yaml
version: "2.0"

services:
  llm:
    image: ghcr.io/huggingface/text-generation-inference:1.1.0
    command:
      - "--model-id"
      - "meta-llama/Llama-2-7b-chat-hf"
      - "--port"
      - "8080"
    env:
      - "HUGGING_FACE_HUB_TOKEN=${HF_TOKEN}"
    expose:
      - port: 8080
        as: 80
        to:
          - global: true
        http_options:
          read_timeout: 60000
          send_timeout: 60000

profiles:
  compute:
    llm:
      resources:
        cpu:
          units: 8
        memory:
          size: 32Gi
        storage:
          size: 100Gi
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
                - model: a100
                  ram: 40Gi

  placement:
    dcloud:
      pricing:
        llm:
          denom: uakt
          amount: 40000

deployment:
  llm:
    dcloud:
      profile: llm
      count: 1
```

## Stable Diffusion Example

```yaml
version: "2.0"

services:
  sd:
    image: stability-ai/stablediffusion:v2.1
    expose:
      - port: 7860
        as: 7860
        to:
          - global: true

profiles:
  compute:
    sd:
      resources:
        cpu:
          units: 4
        memory:
          size: 16Gi
        storage:
          size: 50Gi
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
                - model: rtx3090

  placement:
    dcloud:
      pricing:
        sd:
          denom: uakt
          amount: 20000

deployment:
  sd:
    dcloud:
      profile: sd
      count: 1
```

## GPU Resource Guidelines

| GPU Model | VRAM | Typical Use Case | Price Range (uakt) |
|-----------|------|------------------|-------------------|
| T4 | 16GB | Inference | 10000-20000 |
| RTX 3080 | 10GB | Light training, inference | 15000-25000 |
| RTX 3090 | 24GB | Training, inference | 18000-30000 |
| A10 | 24GB | Training, inference | 25000-40000 |
| RTX A6000 | 48GB | Heavy training | 35000-50000 |
| A100 40GB | 40GB | Large models | 40000-60000 |
| A100 80GB | 80GB | Very large models | 60000-100000 |

## Best Practices

1. **Match GPU to workload**: Use T4 for inference, A100 for training
2. **Consider VRAM**: Large models need GPUs with sufficient memory
3. **Use persistent storage**: Store models and checkpoints persistently
4. **Set appropriate timeouts**: ML inference can be slow; increase HTTP timeouts
5. **Environment variables**: Pass model configs and tokens via env vars



================================================
FILE: rules/examples/ip-lease.md
================================================
# Example: IP Endpoint Lease

SDL configurations using dedicated IP addresses for deployments.

## Use Case

- Custom domain mapping with DNS A records
- Non-HTTP services (SSH, gaming, mail)
- Services requiring fixed IP addresses
- Multi-port applications

## Version Requirement

IP endpoints require SDL version 2.1:

```yaml
version: "2.1"
```

## Basic IP Lease

```yaml
version: "2.1"

services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80
        as: 80
        to:
          - ip: public-ip
      - port: 443
        as: 443
        to:
          - ip: public-ip

endpoints:
  public-ip:
    kind: ip

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi

  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000

deployment:
  web:
    dcloud:
      profile: web
      count: 1
```

## Game Server Example

```yaml
version: "2.1"

services:
  gameserver:
    image: itzg/minecraft-server:java21
    env:
      - "EULA=TRUE"
      - "TYPE=PAPER"
      - "MEMORY=4G"
    expose:
      - port: 25565
        as: 25565
        proto: tcp
        to:
          - ip: game-ip
      - port: 25565
        as: 25565
        proto: udp
        to:
          - ip: game-ip
    params:
      storage:
        world-data:
          mount: /data

endpoints:
  game-ip:
    kind: ip

profiles:
  compute:
    gameserver:
      resources:
        cpu:
          units: 4
        memory:
          size: 6Gi
        storage:
          - name: default
            size: 1Gi
          - name: world-data
            size: 20Gi
            attributes:
              persistent: true
              class: beta2

  placement:
    dcloud:
      pricing:
        gameserver:
          denom: uakt
          amount: 5000

deployment:
  gameserver:
    dcloud:
      profile: gameserver
      count: 1
```

## SSH Access Example

```yaml
version: "2.1"

services:
  dev:
    image: lscr.io/linuxserver/openssh-server:9.6_p1
    env:
      - "PUID=1000"
      - "PGID=1000"
      - "TZ=UTC"
      - "PUBLIC_KEY=ssh-rsa AAAA..."
      - "SUDO_ACCESS=true"
    expose:
      - port: 2222
        as: 22
        proto: tcp
        to:
          - ip: dev-ip

endpoints:
  dev-ip:
    kind: ip

profiles:
  compute:
    dev:
      resources:
        cpu:
          units: 2
        memory:
          size: 4Gi
        storage:
          - name: default
            size: 1Gi
          - name: home
            size: 50Gi
            attributes:
              persistent: true
              class: beta2

  placement:
    dcloud:
      pricing:
        dev:
          denom: uakt
          amount: 3000

deployment:
  dev:
    dcloud:
      profile: dev
      count: 1
```

## Multi-Service with Separate IPs

```yaml
version: "2.1"

services:
  frontend:
    image: nginx:1.25.3
    expose:
      - port: 80
        as: 80
        to:
          - ip: frontend-ip
      - port: 443
        as: 443
        to:
          - ip: frontend-ip

  api:
    image: myapi:v1.0.0
    expose:
      - port: 8080
        as: 80
        to:
          - ip: api-ip
      - port: 8443
        as: 443
        to:
          - ip: api-ip

endpoints:
  frontend-ip:
    kind: ip
  api-ip:
    kind: ip

profiles:
  compute:
    frontend:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi

    api:
      resources:
        cpu:
          units: 2
        memory:
          size: 2Gi
        storage:
          size: 10Gi

  placement:
    dcloud:
      pricing:
        frontend:
          denom: uakt
          amount: 500
        api:
          denom: uakt
          amount: 2000

deployment:
  frontend:
    dcloud:
      profile: frontend
      count: 1
  api:
    dcloud:
      profile: api
      count: 1
```

## Mail Server Example

```yaml
version: "2.1"

services:
  mail:
    image: mailserver/docker-mailserver:13.3.1
    env:
      - "OVERRIDE_HOSTNAME=mail.example.com"
      - "ENABLE_SPAMASSASSIN=1"
      - "ENABLE_CLAMAV=1"
    expose:
      - port: 25
        as: 25
        proto: tcp
        to:
          - ip: mail-ip
      - port: 587
        as: 587
        proto: tcp
        to:
          - ip: mail-ip
      - port: 993
        as: 993
        proto: tcp
        to:
          - ip: mail-ip
    params:
      storage:
        mail-data:
          mount: /var/mail
        mail-state:
          mount: /var/mail-state

endpoints:
  mail-ip:
    kind: ip

profiles:
  compute:
    mail:
      resources:
        cpu:
          units: 2
        memory:
          size: 4Gi
        storage:
          - name: default
            size: 1Gi
          - name: mail-data
            size: 50Gi
            attributes:
              persistent: true
              class: beta2
          - name: mail-state
            size: 10Gi
            attributes:
              persistent: true
              class: beta2

  placement:
    dcloud:
      pricing:
        mail:
          denom: uakt
          amount: 4000

deployment:
  mail:
    dcloud:
      profile: mail
      count: 1
```

## Hybrid: Global + IP Endpoint

```yaml
version: "2.1"

services:
  web:
    image: nginx:1.25.3
    expose:
      # Default Akash hostname (HTTPS with auto-cert)
      - port: 80
        as: 80
        to:
          - global: true
      # Dedicated IP for custom domain
      - port: 80
        as: 8080
        to:
          - ip: custom-ip
      - port: 443
        as: 8443
        to:
          - ip: custom-ip

endpoints:
  custom-ip:
    kind: ip

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi

  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1500

deployment:
  web:
    dcloud:
      profile: web
      count: 1
```

## DNS Configuration

After deployment, configure your DNS:

1. Get the leased IP from deployment status
2. Create DNS A record:
   ```
   example.com.    A    <leased-ip>
   www.example.com.    A    <leased-ip>
   ```
3. For mail servers, add MX and SPF records:
   ```
   example.com.    MX    10 mail.example.com.
   mail.example.com.    A    <leased-ip>
   example.com.    TXT    "v=spf1 ip4:<leased-ip> -all"
   ```

## Best Practices

1. **Use v2.1**: IP endpoints require version "2.1"
2. **Declare before use**: Define endpoints before referencing them
3. **Use all declared endpoints**: Unused endpoints cause validation errors
4. **Consider costs**: IP leases have additional fees beyond compute
5. **Protocol awareness**: Specify `proto: udp` for UDP services
6. **Multiple ports**: Same IP can expose multiple ports



================================================
FILE: rules/examples/web-app.md
================================================
# Example: Simple Web Application

A minimal SDL for deploying a web application on Akash.

## Use Case

- Static websites
- Single-page applications
- Simple API servers
- Development/testing environments

## SDL Configuration

```yaml
version: "2.0"

services:
  web:
    image: nginx:1.25.3
    expose:
      - port: 80
        as: 80
        to:
          - global: true

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi
  placement:
    dcloud:
      pricing:
        web:
          denom: uakt
          amount: 1000

deployment:
  web:
    dcloud:
      profile: web
      count: 1
```

## Variations

### Node.js Application

```yaml
version: "2.0"

services:
  app:
    image: node:18-alpine
    command:
      - "node"
      - "server.js"
    env:
      - "NODE_ENV=production"
      - "PORT=3000"
    expose:
      - port: 3000
        as: 80
        to:
          - global: true

profiles:
  compute:
    app:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 2Gi
  placement:
    dcloud:
      pricing:
        app:
          denom: uakt
          amount: 1500

deployment:
  app:
    dcloud:
      profile: app
      count: 1
```

### Python Flask Application

```yaml
version: "2.0"

services:
  api:
    image: python:3.11-slim
    command:
      - "python"
      - "-m"
      - "flask"
      - "run"
      - "--host=0.0.0.0"
    env:
      - "FLASK_APP=app.py"
      - "FLASK_ENV=production"
    expose:
      - port: 5000
        as: 80
        to:
          - global: true

profiles:
  compute:
    api:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi
  placement:
    dcloud:
      pricing:
        api:
          denom: uakt
          amount: 1000

deployment:
  api:
    dcloud:
      profile: api
      count: 1
```

### Custom Docker Image

```yaml
version: "2.0"

services:
  myapp:
    image: myregistry/myapp:v1.0.0
    credentials:
      host: myregistry.io
      username: ${REGISTRY_USER}
      password: ${REGISTRY_PASS}
    env:
      - "DATABASE_URL=postgres://..."
      - "API_KEY=${API_KEY}"
    expose:
      - port: 8080
        as: 80
        to:
          - global: true
        http_options:
          max_body_size: 10485760
          read_timeout: 30000

profiles:
  compute:
    myapp:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 5Gi
  placement:
    dcloud:
      pricing:
        myapp:
          denom: uakt
          amount: 2000

deployment:
  myapp:
    dcloud:
      profile: myapp
      count: 2
```

## Resource Guidelines

| Application Type | CPU | Memory | Storage |
|-----------------|-----|--------|---------|
| Static site | 0.25-0.5 | 256-512Mi | 512Mi-1Gi |
| Node.js app | 0.5-2 | 512Mi-2Gi | 1-5Gi |
| Python app | 0.5-2 | 512Mi-2Gi | 1-5Gi |
| Go app | 0.25-1 | 128-512Mi | 512Mi-2Gi |

## Tips

1. **Start small**: Begin with minimal resources and scale up as needed
2. **Use specific tags**: Avoid `latest` in production; use specific version tags
3. **Environment variables**: Use env vars for configuration, never hardcode secrets
4. **HTTP options**: Configure timeouts based on your application's needs
5. **Multiple instances**: Set `count: 2` or higher for high availability



================================================
FILE: rules/examples/wordpress-db.md
================================================
# Example: WordPress with Database

A multi-service deployment with WordPress and MariaDB, featuring persistent storage.

## Use Case

- Content management systems
- Multi-tier applications
- Applications requiring databases
- Persistent data storage

## SDL Configuration

```yaml
version: "2.0"

services:
  wordpress:
    image: wordpress:6.4
    env:
      - "WORDPRESS_DB_HOST=db"
      - "WORDPRESS_DB_USER=wordpress"
      - "WORDPRESS_DB_PASSWORD=wordpress_password"
      - "WORDPRESS_DB_NAME=wordpress"
    expose:
      - port: 80
        as: 80
        to:
          - global: true
    params:
      storage:
        wordpress-data:
          mount: /var/www/html
          readOnly: false

  db:
    image: mariadb:10.11
    env:
      - "MYSQL_ROOT_PASSWORD=root_password"
      - "MYSQL_DATABASE=wordpress"
      - "MYSQL_USER=wordpress"
      - "MYSQL_PASSWORD=wordpress_password"
    expose:
      - port: 3306
        to:
          - service: wordpress
    params:
      storage:
        db-data:
          mount: /var/lib/mysql
          readOnly: false

profiles:
  compute:
    wordpress:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          - name: default
            size: 1Gi
          - name: wordpress-data
            size: 10Gi
            attributes:
              persistent: true
              class: beta2

    db:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          - name: default
            size: 1Gi
          - name: db-data
            size: 20Gi
            attributes:
              persistent: true
              class: beta2

  placement:
    dcloud:
      pricing:
        wordpress:
          denom: uakt
          amount: 2000
        db:
          denom: uakt
          amount: 3000

deployment:
  wordpress:
    dcloud:
      profile: wordpress
      count: 1

  db:
    dcloud:
      profile: db
      count: 1
```

## Key Concepts

### Service Communication

Services communicate using service names as hostnames:
- WordPress connects to `db:3306`
- The `db` service is only exposed to `wordpress` service

### Persistent Storage

Both services use persistent storage:
- WordPress content: `/var/www/html`
- Database files: `/var/lib/mysql`

Storage configuration:
```yaml
storage:
  - name: db-data
    size: 20Gi
    attributes:
      persistent: true    # Data survives restarts
      class: beta2        # SSD storage
```

### Storage Mounting

Connect named storage to container paths:
```yaml
params:
  storage:
    db-data:
      mount: /var/lib/mysql
      readOnly: false
```

## Variations

### With Redis Cache

```yaml
version: "2.0"

services:
  wordpress:
    image: wordpress:6.4
    env:
      - "WORDPRESS_DB_HOST=db"
      - "WORDPRESS_DB_USER=wordpress"
      - "WORDPRESS_DB_PASSWORD=wordpress_password"
      - "WORDPRESS_DB_NAME=wordpress"
    expose:
      - port: 80
        as: 80
        to:
          - global: true
    params:
      storage:
        wordpress-data:
          mount: /var/www/html

  db:
    image: mariadb:10.11
    env:
      - "MYSQL_ROOT_PASSWORD=root_password"
      - "MYSQL_DATABASE=wordpress"
      - "MYSQL_USER=wordpress"
      - "MYSQL_PASSWORD=wordpress_password"
    expose:
      - port: 3306
        to:
          - service: wordpress
    params:
      storage:
        db-data:
          mount: /var/lib/mysql

  redis:
    image: redis:7-alpine
    expose:
      - port: 6379
        to:
          - service: wordpress

profiles:
  compute:
    wordpress:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          - name: default
            size: 1Gi
          - name: wordpress-data
            size: 10Gi
            attributes:
              persistent: true
              class: beta2

    db:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          - name: default
            size: 1Gi
          - name: db-data
            size: 20Gi
            attributes:
              persistent: true
              class: beta2

    redis:
      resources:
        cpu:
          units: 0.5
        memory:
          size: 512Mi
        storage:
          size: 1Gi

  placement:
    dcloud:
      pricing:
        wordpress:
          denom: uakt
          amount: 2000
        db:
          denom: uakt
          amount: 3000
        redis:
          denom: uakt
          amount: 1000

deployment:
  wordpress:
    dcloud:
      profile: wordpress
      count: 1
  db:
    dcloud:
      profile: db
      count: 1
  redis:
    dcloud:
      profile: redis
      count: 1
```

### PostgreSQL Variant

```yaml
version: "2.0"

services:
  app:
    image: myapp:v1.0.0
    env:
      - "DATABASE_URL=postgres://appuser:apppassword@db:5432/appdb"
    expose:
      - port: 3000
        as: 80
        to:
          - global: true

  db:
    image: postgres:15
    env:
      - "POSTGRES_USER=appuser"
      - "POSTGRES_PASSWORD=apppassword"
      - "POSTGRES_DB=appdb"
    expose:
      - port: 5432
        to:
          - service: app
    params:
      storage:
        pgdata:
          mount: /var/lib/postgresql/data

profiles:
  compute:
    app:
      resources:
        cpu:
          units: 1
        memory:
          size: 1Gi
        storage:
          size: 2Gi

    db:
      resources:
        cpu:
          units: 2
        memory:
          size: 2Gi
        storage:
          - name: default
            size: 1Gi
          - name: pgdata
            size: 50Gi
            attributes:
              persistent: true
              class: beta2

  placement:
    dcloud:
      pricing:
        app:
          denom: uakt
          amount: 2000
        db:
          denom: uakt
          amount: 4000

deployment:
  app:
    dcloud:
      profile: app
      count: 1
  db:
    dcloud:
      profile: db
      count: 1
```

## Best Practices

1. **Never expose databases globally**: Use `to: - service: <name>` pattern
2. **Use strong passwords**: Even in examples, use secure password patterns
3. **Size storage appropriately**: Databases grow; allocate sufficient space
4. **Use SSD storage**: `class: beta2` for database workloads
5. **Separate compute profiles**: Different resources for app vs database tiers


